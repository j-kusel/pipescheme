<!DOCTYPE html>
<html>
    <head>
        <title>dashboard</title>
        <link rel="stylesheet" href="css/ngCloak.css" />
        <link rel="stylesheet" href="lib/leaflet/dist/leaflet.css" />
        <link rel="stylesheet" href="css/dashboard.css" />
        <script type="text/javascript" src="bower/angular/angular.js"></script>
        <script type="text/javascript" src="bower/angular-resource/angular-resource.js"></script>
    </head>
    <body ng-app="app" ng-controller="PipeController" ng-init="user = <%= JSON.stringify(user) %>; flashmsg = <%= flashmsg %>">
        <div id="headbar">
            <div id="title">
                <h3>PIPESCHEME</h3>
            </div>
            <div id="controls">
                <span class="span-sel">state:</span>
                <div class="select-css">
                    <select class="selector"
                            ng-model="query.state"
                            ng-options="state for state in states"
                            ng-change="updateView()">
                    </select>
                </div>
                <input type="checkbox"
                    id="checker"
                    ng-model="query.fatal"
                    ng-change="updateView()" />
                <label for="checker"><span></span></label>
                <span class="span-check">fatal?</span>
                <span class="span-sel">year:</span>
                <div class="select-css">
                    <select class="selector"
                            ng-model="query.year"
                            ng-options="year for year in years"
                            ng-change="updateView()">
                    </select>
                </div>

            </div>
            <ul id="headmenu">
                <div ng-if="user.firstName">
                    <li>welcome back {{ user.firstName }}!</li>
                    <li style="opacity: .2;">|</li>
                    <li onclick="window.location.href='/logout'" style="cursor: pointer;">logout</li>
                </div>
                <div ng-if="!user.firstName">
                    <li ng-click='toggleModal("signin")' style="cursor: pointer;">signin</li>
                    <li style="opacity: .2;">|</li>
                    <li ng-click='toggleModal("signup")' style="cursor: pointer;">signup</li>
                </div>
                <div>
                    <li style="opacity: .2;">|</li>
                    <li ng-click='toggleModal("about")' style="cursor: pointer;">about</li>
                </div>
            </ul>
        </div>
        <div>
            <ps-modal flashmsg="default" show="modalShow">
                <!-- IF THAT DOESN'T WORK SWITCH BACK TO TEMPLATE TAG -->
                <ps-signin ng-if="formtype==='signin'"></ps-signin>
                <ps-signup ng-if="formtype==='signup'"></ps-signup>
                <ps-lightbox ng-if="formtype==='lightbox'" photo="modalArgs"></ps-lightbox>
                <div ng-if="formtype==='about'" ng-include="'templates/about.html'"></div>               
            </ps-modal>
        </div>
        <div id="main">
            <!--
            <div id="map" style="width: 100%; height: 350px; z-index: 1;"></div>
            -->
            <ps-leaflet focus="focus"></ps-leaflet>

            <ul class="info">
                <li>{{ data[focus].LOCATION_COUNTY_NAME }} CO.</li>
                <li style="opacity: .2;">|</li>
                <li>{{ data[focus].LOCATION_STREET_ADDRESS }}</li>
            </ul>
            <h1 id="city">{{ data[focus].LOCATION_CITY_NAME }}, {{ data[focus].LOCATION_STATE_ABBREVIATION }}</h1>
            <div class="details">
                <ul class="info">
                    <li>{{ data[focus].INCIDENT_IDENTIFIED_DATETIME | date : "MMM dd, y" }}</li>
                    <li style="opacity: .2;">|</li>
                    <li>rpt. #{{ data[focus].REPORT_NUMBER }}</li>
                </ul>
                <p id="narrative">{{ data[focus].NARRATIVE }}</p>
                <!--
                <p>injuries: {{ data[focus].injuries }}</p>
                <p>fatalities: {{ data[focus].fatalities }}</p>
                <p>operator name?: {{ data[focus].operator }}</p>
                <p>operator type?: {{ data[focus].operatorType }}</p>
                <p>investigation?: {{ data[focus].investigation }}</p>
                <p>cause?: {{ data[focus].cause }}</p>
                <p>cause details?: {{ data[focus].causeDetails }}</p>
                <p>work?: {{ data[focus].work }}</p>
                <p>root cause?: {{ data[focus].rootCause }}</p>
                <p>root cause other?: {{ data[focus].rootCauseOther }}</p>
                -->
                <p>{{ data[focus].IYEAR }}</p>
            </div>
    

            <div id="gallery">
                <div class="thumbnail">
                    <form id="upload" action="/api/photos" enctype="multipart/form-data" method="post">
                        <input type="hidden" name="location" value="{{data[focus]._id}}" readonly />
                        <input type="file" id="fileBrowse" name="userPhoto" onchange="upload.submit()" style="display: none;"/>
                    </form>
                    <img src="/assets/uploadButton.png" id="uploadButton" ng-click="photoUpload()" style="cursor: pointer;"/>

                </div>
                <div class="thumbnail" ng-repeat="photo in photos">
                    <img ng-src="{{photo.filename}}?dim=200x100" ng-click="toggleModal('lightbox',[$index])" style="cursor: pointer;" />
                </div>                    
            </div>

        </div>

        <!-- Leaflet.js -->
        <script src="lib/leaflet/dist/leaflet.js"></script>

        <!-- application -->
        <script src="js/app.js"></script>
        <script src="js/config.js"></script>

        <!-- services -->
        <script src="js/services/accident.service.js"></script>
        <script src="js/services/geo.service.js"></script>
        <script src="js/services/photo.service.js"></script>

        <!-- controllers -->
        <script src="js/controllers/pipeScheme.js"></script>

        <!-- directives -->
        <script src="js/directives/psModal.client.directive.js"></script>
        <script src="js/directives/loginForms.client.directive.js"></script>
        <script src="js/directives/lightbox.client.directive.js"></script>
        <script src="js/directives/psLeaflet.client.directive.js"></script>


    </body>
</html>
